<!DOCTYPE html>
<meta charset="utf-8">

<body>
  <!-- This will serve as a container for our chart. This does not have to be a div, and can in fact, just be the body if you want. -->
  <div id="my-chart"></div>    
  <script src="//d3js.org/d3.v3.min.js"></script>
</body>   
    
<script>
viewof source = {
  const textarea = html`<textarea rows=10>`;
  textarea.value = (await FileAttachment("dream.txt").text()).trim();
  textarea.style = `
  display: block;
  boxSizing: border-box;
  width: calc(100% + 28px);
  font: var(--mono_fonts);
  border: none;
  border-radius: 0;
  padding: 6px 10px;
  margin: 0 -14px;
  background: #f5f5f5;
  tabSize: 2;
  outline: none;
  resize: none;
`;
  return textarea;
}
  
fontFamily = "sans-serif"
  
fontScale = 15
  
rotate = () => 0 // () => (~~(Math.random() * 6) - 3) * 30
  
padding = 0
  
height = 500
  
words = source.split(/[\s.]+/g)
  .map(w => w.replace(/^[“‘"\-—()\[\]{}]+/g, ""))
  .map(w => w.replace(/[;:.!?()\[\]{},"'’”\-—]+$/g, ""))
  .map(w => w.replace(/['’]s$/g, ""))
  .map(w => w.substring(0, 30))
  .map(w => w.toLowerCase())
  .filter(w => w && !stopwords.has(w))

words.filter(w => /\W/.test(w))

data = d3.rollups(words, group => group.length, w => w)
  .sort(([, a], [, b]) => d3.descending(a, b))
  .slice(0, 250)
  .map(([text, value]) => ({text, value}))

  
stopwords = new Set("i,me,my,myself,we,us,our,ours,ourselves,you,your,yours,yourself,yourselves,he,him,his,himself,she,her,hers,herself,it,its,itself,they,them,their,theirs,themselves,what,which,who,whom,whose,this,that,these,those,am,is,are,was,were,be,been,being,have,has,had,having,do,does,did,doing,will,would,should,can,could,ought,i'm,you're,he's,she's,it's,we're,they're,i've,you've,we've,they've,i'd,you'd,he'd,she'd,we'd,they'd,i'll,you'll,he'll,she'll,we'll,they'll,isn't,aren't,wasn't,weren't,hasn't,haven't,hadn't,doesn't,don't,didn't,won't,wouldn't,shan't,shouldn't,can't,cannot,couldn't,mustn't,let's,that's,who's,what's,here's,there's,when's,where's,why's,how's,a,an,the,and,but,if,or,because,as,until,while,of,at,by,for,with,about,against,between,into,through,during,before,after,above,below,to,from,up,upon,down,in,out,on,off,over,under,again,further,then,once,here,there,when,where,why,how,all,any,both,each,few,more,most,other,some,such,no,nor,not,only,own,same,so,than,too,very,say,says,said,shall".split(","))
  
d3 = {
  const d3 = await require("d3@5", "d3-array@2");
  d3.cloud = await require("d3-cloud@1");
  return d3;
}
</script>
